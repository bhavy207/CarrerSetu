import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import DataForm from './components/DataForm';
import ResultsView from './components/ResultsView';
import axios from 'axios';
import { Loader } from 'lucide-react';

const App = () => {
  const [step, setStep] = useState<'form' | 'loading' | 'result'>('form');
  const [pathwayData, setPathwayData] = useState<any>(null);

  const handleFormSubmit = async (formData: any) => {
    setStep('loading');
    try {
      // Use axios to post to backend
      const response = await axios.post('http://127.0.0.1:8000/api/v1/learner/profile', formData);
      setPathwayData(response.data);
      setStep('result');
    } catch (err) {
      console.error(err);
      alert("Error fetching pathway. Please make sure the backend is running.");
      setStep('form');
    }
  };

  return (
    <div style={{ minHeight: '100vh', padding: '2rem' }}>
      <motion.header
        initial={{ y: -50, opacity: 0 }}
        animate={{ y: 0, opacity: 1 }}
        transition={{ duration: 0.8 }}
        style={{ textAlign: 'center', marginBottom: '3rem' }}
      >
        <h1 className="text-gradient" style={{ fontSize: '3.5rem', margin: '0 0 1rem 0', fontWeight: 800 }}>Career Setu</h1>
        <p style={{ fontSize: '1.2rem', color: 'var(--text-secondary)', maxWidth: '600px', margin: '0 auto' }}>
          AI-Powered Intelligent Career Navigator & Personalized Pathway Engine
        </p>
      </motion.header>

      <AnimatePresence mode='wait'>
        {step === 'form' && (
          <motion.div key="form" initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: -20 }}>
            <DataForm onSubmit={handleFormSubmit} />
          </motion.div>
        )}

        {step === 'loading' && (
          <motion.div key="loading" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}
            style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: '400px' }}
          >
            <motion.div
              animate={{ rotate: 360 }}
              transition={{ repeat: Infinity, duration: 1, ease: 'linear' }}
            >
              <Loader size={48} color="var(--primary)" />
            </motion.div>
            <p style={{ marginTop: '1rem', color: 'var(--text-secondary)' }}>Analysing Profile & Generating Pathway...</p>
          </motion.div>
        )}

        {step === 'result' && pathwayData && (
          <motion.div key="result" initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} exit={{ opacity: 0, scale: 1.05 }}>
            <ResultsView data={pathwayData} onReset={() => setStep('form')} />
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
};

export default App;
